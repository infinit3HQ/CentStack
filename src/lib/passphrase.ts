/**
 * Passphrase generator and strength checker.
 * Uses Web Crypto for true randomness.
 */

// ─── Wordlist (EFF-inspired short list) ─────────────────────────

const WORDS = [
  "amber",
  "anvil",
  "apple",
  "arctic",
  "arrow",
  "atlas",
  "baron",
  "bench",
  "birch",
  "blast",
  "blaze",
  "blend",
  "bloom",
  "brace",
  "brave",
  "brick",
  "brisk",
  "brook",
  "brute",
  "cabin",
  "candy",
  "cargo",
  "cedar",
  "chalk",
  "charm",
  "check",
  "chess",
  "chief",
  "chimp",
  "chunk",
  "civil",
  "clamp",
  "clasp",
  "clean",
  "cliff",
  "cloak",
  "clock",
  "clone",
  "cloth",
  "cloud",
  "clove",
  "coast",
  "cobra",
  "comet",
  "coral",
  "crane",
  "crest",
  "crisp",
  "cross",
  "crown",
  "crush",
  "crypt",
  "cubic",
  "curve",
  "cycle",
  "dandy",
  "darts",
  "dawn",
  "delta",
  "depot",
  "depth",
  "derby",
  "digit",
  "disco",
  "diver",
  "dodge",
  "dogma",
  "dover",
  "draft",
  "drake",
  "drama",
  "drape",
  "drive",
  "drone",
  "drums",
  "dunes",
  "eagle",
  "earth",
  "ebony",
  "ember",
  "epoch",
  "equip",
  "error",
  "event",
  "exact",
  "extra",
  "fable",
  "facet",
  "faith",
  "false",
  "fancy",
  "fangs",
  "fargo",
  "fault",
  "feast",
  "fence",
  "flame",
  "flank",
  "flask",
  "fleet",
  "flesh",
  "flick",
  "flint",
  "float",
  "flood",
  "flora",
  "fluid",
  "fluke",
  "focal",
  "forge",
  "forge",
  "forte",
  "forum",
  "fossil",
  "found",
  "frank",
  "fresh",
  "front",
  "frost",
  "froze",
  "fungi",
  "gains",
  "gamma",
  "garnet",
  "gavel",
  "gears",
  "giant",
  "glare",
  "glass",
  "glide",
  "globe",
  "gloom",
  "glory",
  "gloss",
  "glove",
  "glyph",
  "gnome",
  "grace",
  "grant",
  "grasp",
  "gravel",
  "green",
  "greet",
  "grid",
  "grind",
  "groan",
  "grove",
  "growl",
  "gruel",
  "guide",
  "guild",
  "guile",
  "guise",
  "gusto",
  "haven",
  "hedge",
  "helix",
  "herbs",
  "heron",
  "honor",
  "horse",
  "hydro",
  "image",
  "index",
  "inert",
  "infer",
  "inlet",
  "input",
  "inter",
  "ionic",
  "ivory",
  "jelly",
  "jewel",
  "joust",
  "judge",
  "juicy",
  "jumbo",
  "karma",
  "kinetic",
  "knife",
  "knoll",
  "label",
  "lance",
  "lapel",
  "laser",
  "latch",
  "latte",
  "layer",
  "leash",
  "ledge",
  "level",
  "light",
  "lilac",
  "links",
  "locust",
  "lodge",
  "logic",
  "lunar",
  "lustre",
  "magma",
  "maker",
  "maple",
  "marsh",
  "match",
  "mauve",
  "merit",
  "metal",
  "micro",
  "milky",
  "mimic",
  "minor",
  "minus",
  "mirth",
  "miser",
  "model",
  "mojave",
  "monk",
  "morph",
  "mosaic",
  "mount",
  "mouse",
  "muddy",
  "mural",
  "nerve",
  "nexus",
  "night",
  "noble",
  "nomad",
  "north",
  "notch",
  "novel",
  "nymph",
  "oblong",
  "octal",
  "olive",
  "orbit",
  "order",
  "overt",
  "oxide",
  "ozone",
  "paint",
  "panel",
  "panic",
  "parcel",
  "paste",
  "patch",
  "patio",
  "pause",
  "peach",
  "pearl",
  "pedal",
  "penal",
  "perch",
  "phase",
  "photo",
  "pilot",
  "pinch",
  "pixel",
  "pizza",
  "pivot",
  "pixel",
  "plain",
  "plane",
  "plant",
  "plaza",
  "plumb",
  "plume",
  "plunge",
  "polar",
  "pouch",
  "power",
  "prism",
  "probe",
  "prone",
  "prose",
  "proud",
  "pulse",
  "punch",
  "quota",
  "quote",
  "radar",
  "radon",
  "rally",
  "rapid",
  "raven",
  "rebel",
  "relic",
  "remix",
  "repel",
  "reply",
  "resin",
  "retry",
  "realm",
  "relay",
  "ridge",
  "rivet",
  "robot",
  "rocky",
  "rogue",
  "rotor",
  "royal",
  "rugby",
  "rumble",
  "rural",
  "sabre",
  "salvo",
  "satin",
  "scale",
  "scene",
  "scone",
  "scope",
  "scout",
  "scram",
  "scrub",
  "serum",
  "seven",
  "shaft",
  "shake",
  "shall",
  "shape",
  "sharp",
  "shear",
  "shield",
  "shift",
  "shine",
  "shore",
  "sigma",
  "silky",
  "sinew",
  "sixth",
  "skate",
  "skill",
  "skull",
  "slate",
  "sleek",
  "sleet",
  "slick",
  "slide",
  "slope",
  "sloth",
  "smart",
  "smash",
  "smell",
  "smoke",
  "snare",
  "solar",
  "solid",
  "solve",
  "sonic",
  "south",
  "spark",
  "spawn",
  "spear",
  "speed",
  "spell",
  "spend",
  "spire",
  "spoil",
  "spoke",
  "spoon",
  "spray",
  "squad",
  "stack",
  "stake",
  "stale",
  "stand",
  "stark",
  "start",
  "steel",
  "steep",
  "steer",
  "stern",
  "stick",
  "stiff",
  "still",
  "stomp",
  "stone",
  "stove",
  "storm",
  "story",
  "strap",
  "straw",
  "stray",
  "strip",
  "strum",
  "strut",
  "study",
  "style",
  "sugar",
  "suite",
  "sulky",
  "super",
  "surge",
  "swamp",
  "swarm",
  "swear",
  "sweep",
  "sweet",
  "swept",
  "swirl",
  "sword",
  "synth",
  "table",
  "tabby",
  "tidal",
  "tiger",
  "tight",
  "timer",
  "title",
  "token",
  "topic",
  "torch",
  "total",
  "tower",
  "toxic",
  "trace",
  "track",
  "trade",
  "trail",
  "trait",
  "tramp",
  "trend",
  "tribe",
  "trick",
  "tried",
  "trill",
  "troll",
  "troop",
  "trove",
  "truce",
  "truly",
  "trump",
  "trust",
  "tufted",
  "tuner",
  "turbo",
  "tutor",
  "twine",
  "ultra",
  "umbra",
  "under",
  "union",
  "unity",
  "until",
  "upper",
  "urban",
  "usage",
  "valid",
  "valor",
  "valve",
  "vapour",
  "vault",
  "venom",
  "verge",
  "verse",
  "vigor",
  "viral",
  "visor",
  "vortex",
  "voter",
  "vowel",
  "vulcan",
  "waltz",
  "warden",
  "watch",
  "water",
  "weave",
  "wedge",
  "whirl",
  "white",
  "wider",
  "wield",
  "windy",
  "wired",
  "witch",
  "world",
  "worst",
  "worth",
  "wrath",
  "xenon",
  "yacht",
  "yearn",
  "yield",
  "zebra",
  "zenith",
  "zonal",
];

// ─── Generator ───────────────────────────────────────────────────

/**
 * Generate a memorable random passphrase.
 * Default: 4 words + 2-digit number = ~50 bits of entropy.
 */
export function generatePassphrase(wordCount = 4): string {
  const indices = new Uint32Array(wordCount);
  crypto.getRandomValues(indices);
  const words = Array.from(indices).map((n) => WORDS[n % WORDS.length]);
  const suffix = (crypto.getRandomValues(new Uint8Array(1))[0] % 90) + 10;
  return [...words, String(suffix)].join("-");
}

// ─── Strength ────────────────────────────────────────────────────

export type StrengthLabel =
  | "very weak"
  | "weak"
  | "fair"
  | "strong"
  | "very strong";

export interface StrengthResult {
  score: 0 | 1 | 2 | 3 | 4;
  label: StrengthLabel;
  color: string;
  pct: number;
  tips: string[];
}

export function checkStrength(p: string): StrengthResult {
  const tips: string[] = [];
  let score = 0;

  if (p.length >= 8) score++;
  else tips.push("at least 8 characters");
  if (p.length >= 16) score++;
  else if (p.length >= 8) tips.push("16+ chars is stronger");
  if (/[A-Z]/.test(p)) score++;
  else tips.push("add uppercase letter");
  if (/[0-9]/.test(p)) score++;
  else tips.push("add a number");
  if (/[^A-Za-z0-9]/.test(p)) score++;
  else tips.push("add a symbol or use words with dashes");

  const clamped = Math.min(score, 4) as 0 | 1 | 2 | 3 | 4;
  const labels: StrengthLabel[] = [
    "very weak",
    "weak",
    "fair",
    "strong",
    "very strong",
  ];
  const colors = [
    "hsl(0 80% 52%)",
    "hsl(20 80% 52%)",
    "hsl(42 80% 52%)",
    "hsl(90 60% 46%)",
    "hsl(142 60% 52%)",
  ];

  return {
    score: clamped,
    label: labels[clamped],
    color: colors[clamped],
    pct: (clamped / 4) * 100,
    tips,
  };
}
